"use strict";(self.webpackChunkbuildflow_docs=self.webpackChunkbuildflow_docs||[]).push([[4848],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>f});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},l=Object.keys(e);for(o=0;o<l.length;o++)r=l[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)r=l[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=o.createContext({}),u=function(e){var t=o.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=u(e.components);return o.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),c=u(r),m=n,f=c["".concat(s,".").concat(m)]||c[m]||d[m]||l;return r?o.createElement(f,i(i({ref:t},p),{},{components:r})):o.createElement(f,i({ref:t},p))}));function f(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=r.length,i=new Array(l);i[0]=m;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a[c]="string"==typeof e?e:n,i[1]=a;for(var u=2;u<l;u++)i[u]=r[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}m.displayName="MDXCreateElement"},4778:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>u});var o=r(7462),n=(r(7294),r(3905));const l={},i="Collectors",a={unversionedId:"user-guides/collectors/overview",id:"user-guides/collectors/overview",title:"Collectors",description:"The Collector is the pattern provided by BuildFlow for creating an HTTP endpoint that dumps to a give sink. It contains all of the user's processing logic between an HTTP request and a sink.",source:"@site/docs/user-guides/collectors/overview.md",sourceDirName:"user-guides/collectors",slug:"/user-guides/collectors/overview",permalink:"/docs/user-guides/collectors/overview",draft:!1,editUrl:"https://github.com/launchflow/buildflow-docs/tree/main/docs/user-guides/collectors/overview.md",tags:[],version:"current",frontMatter:{},sidebar:"mainSidebar",previous:{title:"Pipeline Options",permalink:"/docs/user-guides/pipelines/pipeline-options"},next:{title:"Collector Options",permalink:"/docs/user-guides/collectors/collector-options"}},s={},u=[{value:"Multi-Row Output",id:"multi-row-output",level:2}],p={toc:u},c="wrapper";function d(e){let{components:t,...r}=e;return(0,n.kt)(c,(0,o.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"collectors"},"Collectors"),(0,n.kt)("p",null,"The ",(0,n.kt)("strong",{parentName:"p"},"Collector")," is the pattern provided by ",(0,n.kt)("strong",{parentName:"p"},"BuildFlow")," for creating an HTTP endpoint that dumps to a give sink. It contains all of the user's processing logic between an HTTP request and a sink."),(0,n.kt)("p",null,"A collector is composed of:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A ",(0,n.kt)("inlineCode",{parentName:"li"},"route"),": this is the path that the endpoint will be available at."),(0,n.kt)("li",{parentName:"ul"},"A ",(0,n.kt)("inlineCode",{parentName:"li"},"method"),": this is the HTTP method that the endpoint will be available at currently GET and POST are supported."),(0,n.kt)("li",{parentName:"ul"},"A ",(0,n.kt)("inlineCode",{parentName:"li"},"sink")," ",(0,n.kt)("a",{parentName:"li",href:"../primitives/overview"},"primitive")),(0,n.kt)("li",{parentName:"ul"},"Your processing Logic.")),(0,n.kt)("p",null,"Collectors are created using the ",(0,n.kt)("inlineCode",{parentName:"p"},"collector")," decorator method of the ",(0,n.kt)("a",{parentName:"p",href:"../flows/overview"},(0,n.kt)("inlineCode",{parentName:"a"},"Flow"))," class."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},'\n@app.collector(route="/", method="POST", sink=Primitive(...))\ndef my_collector(...):\n    ...\n\n')),(0,n.kt)("p",null,"The input of your collector will be one request from your HTTP endpoint. You can use a dataclass to define a JSON payload that you expect."),(0,n.kt)("p",null,"The element you return from your collector will be written to your ",(0,n.kt)("inlineCode",{parentName:"p"},"sink")," primitive. For instance if your sink type is an OLAP datastore (like GCP BigQuery or Snowflake) one row will be written for each element you return from your processor. Or if you sink is a queue (like Kafka, GCP Pub/Sub, or AWS SQS) then one message will be published for each element you return from your processor."),(0,n.kt)("h2",{id:"multi-row-output"},"Multi-Row Output"),(0,n.kt)("p",null,"BuildFlow also supports collectors that return multiple rows. To accomplish this you can either return a ",(0,n.kt)("inlineCode",{parentName:"p"},"List")," or ",(0,n.kt)("inlineCode",{parentName:"p"},"Tuple")," and BuildFlow will flatten each element into it's own row."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},'@app.collector(route="/", method="POST", sink=Primitive(...))\ndef my_collector(message):\n    return [output(message), output1(message), output2(message)]\n\n')),(0,n.kt)("p",null,"You can also use yields to return multiple elements that should be written to your sink."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-python"},'@app.collector(route="/", method="POST", ink=Primitive(...))\ndef my_collector(message):\n    if message.startswith("hello"):\n        yield "world"\n    if message.endswith("world"):\n        yield "!"\n\n')),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"If you want your row to be a list you can wrap it in a ",(0,n.kt)("inlineCode",{parentName:"p"},"Tuple")," to avoid flattening."),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-python"},'@app.collector(route="/", method="POST", sink=Primitive(...))\ndef my_collector(message):\n    return [[output(message), output1(message), output2(message)]]\n'))))}d.isMDXComponent=!0}}]);