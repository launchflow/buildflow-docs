"use strict";(self.webpackChunkbuildflow_docs=self.webpackChunkbuildflow_docs||[]).push([[956],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>b});var n=o(7294);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,i=function(e,t){if(null==e)return{};var o,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var c=n.createContext({}),l=function(e){var t=n.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},f=n.forwardRef((function(e,t){var o=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=l(o),f=i,b=p["".concat(c,".").concat(f)]||p[f]||d[f]||r;return o?n.createElement(b,a(a({ref:t},u),{},{components:o})):n.createElement(b,a({ref:t},u))}));function b(e,t){var o=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=o.length,a=new Array(r);a[0]=f;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:i,a[1]=s;for(var l=2;l<r;l++)a[l]=o[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}f.displayName="MDXCreateElement"},6234:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var n=o(7462),i=(o(7294),o(3905));const r={},a="Google Cloud Storage Notifications",s={unversionedId:"io-providers/gcs_notifications",id:"io-providers/gcs_notifications",title:"Google Cloud Storage Notifications",description:"The GCS Notification source subscribes to changes to a Google Cloud Storage bucket. This source is a streaming source. You provide the source with the GCP project and the GCS bucket you would like to listen to and BuildFlow will configure your application to listen to changes. It does this by setting up a Pub/Sub topic and subscriber that will listen to changes on the bucket. If you have already configured a topic and subscriber for this you can also manually pass those.",source:"@site/docs/io-providers/gcs_notifications.md",sourceDirName:"io-providers",slug:"/io-providers/gcs_notifications",permalink:"/docs/io-providers/gcs_notifications",draft:!1,editUrl:"https://github.com/launchflow/buildflow-docs/tree/main/docs/io-providers/gcs_notifications.md",tags:[],version:"current",frontMatter:{}},c={},l=[{value:"Source Output Type",id:"source-output-type",level:2},{value:"Source Class Definition",id:"source-class-definition",level:2},{value:"Example Usage",id:"example-usage",level:3},{value:"GCS Notifications to BigQuery",id:"gcs-notifications-to-bigquery",level:3}],u={toc:l},p="wrapper";function d(e){let{components:t,...o}=e;return(0,i.kt)(p,(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"google-cloud-storage-notifications"},"Google Cloud Storage Notifications"),(0,i.kt)("p",null,"The GCS Notification source subscribes to changes to a Google Cloud Storage bucket. This source is a streaming source. You provide the source with the GCP project and the GCS bucket you would like to listen to and BuildFlow will configure your application to listen to changes. It does this by setting up a Pub/Sub topic and subscriber that will listen to changes on the bucket. If you have already configured a topic and subscriber for this you can also manually pass those."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"There is a known edge case with the automatic GCS setup. This will be in an upcoming major release (coming summer, 2023). It is recommended that you manually set up your GCS notifications for now.")),(0,i.kt)("h2",{id:"source-output-type"},"Source Output Type"),(0,i.kt)("p",null,"The GCS notification source will return a ",(0,i.kt)("inlineCode",{parentName:"p"},"GCSFileEvent")," object with the following fields:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"metadata"),": A dictionary of metadata about the events"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"blob"),": Fetches the binary contents of the file")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("inlineCode",{parentName:"p"},"blob")," is fetched lazily so if you do not call it the binary contents will not be retrieved.")),(0,i.kt)("h2",{id:"source-class-definition"},"Source Class Definition"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"class GCSFileNotifications(io.Source):\n    bucket_name: str\n    project_id: str\n    # The pubsub topic that is configured to point at the bucket. If not set\n    # we will create one.\n    pubsub_topic: str = ''\n    # The pubsub subscription that is configure to point at the bucket. If not\n    # set we will create one.\n    pubsub_subscription: str = ''\n    # The event types that should trigger the stream. This is only used if we\n    # are attaching a new notification listener to your bucket. Defaults to\n    # only new uploads. If set to None will listen to all uploads.\n    event_types: Optional[List[str]] = ('OBJECT_FINALIZE', )\n")),(0,i.kt)("h3",{id:"example-usage"},"Example Usage"),(0,i.kt)("h3",{id:"gcs-notifications-to-bigquery"},"GCS Notifications to BigQuery"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"input_sub = GCSFileNotifications(\n    bucket_name='bucket-name',\n    project_id='gcp-project')\noutput_table = buildflow.BigQuerySink(table_id='project.dataset.table')\n\napp = Node()\n\n@app.processor(source=input_sub, sink=output_table)\ndef process(element: GCSFileEvent):\n    return process_bytes(elemet.blob)\n\napp.run()\n")))}d.isMDXComponent=!0}}]);